{% extends "sistema_2/layout_3.html" %}

{% load static %}

{% block code %}

<link href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
<script src="{% static 'sistema_2/cotizaciones.js' %}"></script>

{% endblock %}


{% block content%}

<div class="container">
  <h1>Cotizaciones</h1>
  <div>
      <a class="btn btn-success" href="{% url 'sistema_2:crear_proforma' %}">Nuevo <i class="fas fa-file-import"></i></a>
  </div>
  <br>
  <div>
    <form class="row g-12" method="post" action="{% url 'sistema_2:proformas' %}">
    {% csrf_token %}
        <div class="col-md-2">
            <label>Fecha inicial</label>
            <input type="date" class="form-control col-md-1" name="fecha_inicio" value="{{ fecha_inicial }}">
        </div>
        <div class="col-md-2">
            <label>Fecha final</label>
            <input type="date" class="form-control col-md-1" name="fecha_fin" value="{{ fecha_final }}">
        </div>
        <br>
        <br>
        <br>
        <div>
            <button type="submit" class="btn btn-success" name="Filtrar">Filtrar</button>
            <button type="submit" class="btn btn-success float-end" name="Exportar">Exportar Excel</button>
        </div>
    </form>
    <br>
    <a class="btn btn-success float-left" style="color: white;" href="{% url 'sistema_2:proformas' %}">Reestablecer</a>
  </div>
  <br>
  <table class="table table-bordered table-hover" id="proformasTable">
      <thead class="table-dark">
          <tr>
              <th scope="col">ID</th>
              <th scope="col">Codigo</th>
              <th scope="col">Vendedor</th>
              <th scope="col">Fecha</th>
              <th scope="col">Tipo</th>
              <th scope="col">Estado</th>
              <th scope="col">Cliente</th>
              <th scope="col">Descargar Cotizacion</th>
              <th scope="col">Generar comprobante</th>
              <th scope="col">Editar</th>
              <th scope="col">Anular</th>
          </tr>
      </thead>
      <tbody>
          {% for cot in cotizaciones %}
          <tr>
              <th scope="row">{{ cot.id }}</th>
              <td>{{ cot.codigoProforma }}</td>
              <td>{{ cot.vendedor.1 }}</td>
              <td>{{ cot.fechaProforma }}</td>
              <td>{{ cot.tipoProforma }}</td>
              <td>
                {% if cot.estadoProforma == 'Generada' %}
                    <div class="bg-success rounded-pill" style="color: white; padding: 1px 6px 1px 6px; text-align: center;">{{ cot.estadoProforma }}</div>
                {% endif %}
                {% if cot.estadoProforma == 'Emitida' %}
                    <div class="bg-warning rounded-pill" style="color: white; padding: 1px 6px 1px 6px; text-align: center;">{{ cot.estadoProforma }}</div>
                {% endif %}
                {% if cot.estadoProforma == 'Anulada' %}
                    <div class="bg-danger rounded-pill" style="color: white; padding: 1px 6px 1px 6px; text-align: center;">{{ cot.estadoProforma }}</div>
                {% endif %}
              </td>
              {% if cot.cliente.1 == '' %}
              <td>{{ cot.cliente.3 }}</td>
              {% else %}
              <td>{{ cot.cliente.1 }} {{ cot.cliente.2 }}</td>
              {% endif %}
              <td style="text-align: center;"><a class="btn btn-info" href="{% url 'sistema_2:descargar_proforma' cot.id %}"><i class="fas fa-download"></i></a></td>
              <td style="text-align: center;">
                {% if cot.estadoProforma == 'Generada' %}
                    {% if cot.cliente.1 == '' %}
                        {% if cot.tipoProforma == 'Productos' %}
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_factura_cot' cot.id %}">F</a>
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_guia_cot' cot.id %}">G</a>
                        {% else %}
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_factura_cot' cot.id %}">F</a>
                        {% endif %}
                    {% else %}
                        {% if cot.tipoProforma == 'Productos' %}
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_boleta_cot' cot.id %}">B</a>
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_guia_cot' cot.id %}">G</a>
                        {% else %}
                        <a class="btn btn-success" href="{% url 'sistema_2:gen_boleta_cot' cot.id %}">B</a>
                        {% endif %}
                    {% endif %}
                {% endif %}
              </td>
              <td style="text-align: center;">
                <a class="btn btn-warning" href="{% url 'sistema_2:editar_proforma' cot.id %}"><i class="fa fa-edit"></i></a>
              </td>
              <td style="text-align: center;">
                {% if cot.estadoProforma == 'Generada' %}
                    <a class="btn btn-danger" href="{% url 'sistema_2:eliminar_proforma' cot.id %}"><i class="fa fa-trash"></i></a>
                {% else %}
                {% endif %}
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
</div>


{% endblock %}